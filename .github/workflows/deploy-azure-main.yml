name: Build Azure Function App

on:
  push:
    branches:
      - develop

jobs:
  build:
    runs-on: windows-latest

    steps:
    - name: Setup .NET Core 3.1 SDK
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '3.1.x'

    - name: Setup .NET 5 SDK
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: '5.0.x'

    - name: Checkout code
      uses: actions/checkout@v3

    - name: List for checkout
      run: |
        cd ${{ github.workspace }}
        pwd
        dir /s

    - name: Build Project
      run: dotnet build ${{ github.workspace }}/HttpPostExperiment/HttpPostExperiment.csproj --output ${{ github.workspace }}/publish_output --configuration Release

    - name: Archive files
      run: |
        mkdir -p ${{ github.workspace }}/artifacts
        powershell Compress-Archive -Path ${{ github.workspace }}/publish_output\* -DestinationPath ${{ github.workspace }}/artifacts\build.zip

    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: drop
        path: ${{ github.workspace }}/artifacts/build.zip

    - name: List after build
      run: |
        cd ${{ github.workspace }}
        pwd
        dir /s
